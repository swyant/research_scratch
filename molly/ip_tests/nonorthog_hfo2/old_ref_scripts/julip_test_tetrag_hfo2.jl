using ACE1 
using CSV, DataFrames
using JuLIP


rpib3 = ACE1.rpi_basis(;
            species = [:Hf, :O],
            N       = 3, 
            maxdeg  = 10,
            D       = ACE1.SparsePSHDegree(; wL = 1.5, csp = 1.0),
            r0      = 2.15,
            rin     = 0.65*2.15,  # Does this meaningfully get used in pin=0?
            rcut    = 5.0,
            pin     = 0,
)


coeffs = vec(Matrix(CSV.read("./N3_rcut5_maxdeg10_1e-3lambdaQR_fit_coeffs.csv",DataFrame,header=false)))
vref = JuLIP.OneBody([:Hf => -2.70516846, :O => -0.01277342]...)

pot_reg_tmp3 = JuLIP.MLIPs.combine(rpib3,coeffs)
pot_reg3 = JuLIP.MLIPs.SumIP(pot_reg_tmp3,vref)

test_xyz_file = "./test_tetrag_hfo2.xyz" 
test_data = read_extxyz(test_xyz_file)

@show forces(pot_reg3,test_data[1])
"""
[0.2934028307390705, 2.2391463760449795, 3.5805991253302176]
[2.5019366314010165, 0.3079130993183768, -1.4811393668002797]
[0.9859633875966003, 1.262312972998325, -0.07248787421350045]
[2.2869528851334344, 1.8107239321108812, 2.9778492198087205]
[-0.5435944423828565, 4.861722008036488, -1.7159494358065466]
[0.2323767747204029, 1.527268672699479, 0.6949390029617312]
[-0.800288360021101, -2.2978908985722555, 0.3721054574265601]
[-1.7465470598049597, -0.1412051573864458, -0.5735341469151627]
â‹®
[0.14693092843799738, 0.14847947559593322, -2.1376010680835273]
[0.5138537348603492, 2.5757809515502963, 2.767277665444536]
[0.6266532756694425, 4.539050978279315, -3.77805556858263]
[2.0188685792346512, -0.6950478558384292, -0.7356089824392313]
[-2.4630114832275414, 1.2662416036859623, 2.4546481119580994]
[-0.5539128843935728, 0.8534391002029372, -1.4364064954305382]
[-0.20136050443104403, -1.762099520377197, -0.7861252922103974]
[4.826567066647032, 0.39094008890011334, -1.3451879070515775]
"""
